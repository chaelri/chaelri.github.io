<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini Code Bucket Downloader</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Material Symbols Outlined CDN -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css" />

    <style>
      /* Define dark theme variables */
      :root {
        --bg-dark: #121212;
        --card-dark: #1e1e1e;
        --text-light: #e0e0e0;
        --accent-blue: #3b82f6;
        --border-dark: #333;
      }
    </style>
  </head>
  <body class="bg-gray-900 text-gray-200 min-h-screen">
    <div class="max-w-4xl mx-auto p-4 md:p-8">
      <header
        class="mb-8 border-b border-gray-700 pb-4 flex justify-between items-center"
      >
        <div>
          <h1
            class="text-3xl font-bold tracking-tight flex items-center gap-3 text-white"
          >
            <span class="material-symbols-outlined text-4xl text-blue-500"
              >inventory_2</span
            >
            Gemini Code Bucket
          </h1>
          <p id="item-count" class="text-sm text-gray-400 mt-1"></p>
        </div>

        <div class="flex gap-4">
          <button id="download-all-btn" class="hidden btn-primary">
            <span class="material-symbols-outlined">download</span>
            Download All
          </button>
          <button id="clear-all-btn" class="btn-secondary">
            <span class="material-symbols-outlined">delete_sweep</span>
            Clear Bucket
          </button>
        </div>
      </header>

      <div id="code-bucket-grid" class="space-y-4">
        <!-- Code blocks will be injected here by JavaScript -->
        <div id="loading-message" class="text-center py-10 text-gray-500">
          Checking Tampermonkey storage...
        </div>
      </div>
    </div>

    <!-- CRITICAL: Tampermonkey Storage Bridge (must run before content-script.js) -->
    <script>
      // This function exists in the global scope of the page.
      // It uses Custom Events to communicate with the Tampermonkey script's isolated world.
      function getGMValue(key, callback) {
        window.addEventListener(
          "GM_Value_Response_" + key,
          function (event) {
            callback(event.detail.value);
          },
          { once: true }
        );

        window.dispatchEvent(
          new CustomEvent("GM_Value_Request", { detail: { key: key } })
        );
      }

      function setGMValue(key, value) {
        window.dispatchEvent(
          new CustomEvent("GM_Value_Set", {
            detail: { key: key, value: value },
          })
        );
      }

      // The Tampermonkey script's isolated world runs a listener that fires these events.
      // We will put the listener in the UserScript itself.
    </script>

    <!-- Custom JavaScript -->
    <script src="script.js"></script>

    <!-- Custom JavaScript -->
    <script src="script.js"></script>
  </body>
</html>
